/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package sim.kantordesa.mailtemplate;

import com.itextpdf.kernel.pdf.PdfDocument;
import com.itextpdf.kernel.pdf.PdfWriter;
import com.itextpdf.layout.Document;
import com.itextpdf.layout.borders.Border;
import com.itextpdf.layout.element.Paragraph;
import com.itextpdf.layout.element.Table;
import com.itextpdf.layout.element.Text;
import com.itextpdf.layout.properties.TextAlignment;
import com.itextpdf.layout.properties.UnitValue;
import java.io.FileInputStream;
import java.io.IOException;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.text.SimpleDateFormat;
import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.util.HashMap;
import java.util.Map;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JFileChooser;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import org.apache.tika.exception.TikaException;
import org.apache.tika.parser.ParseContext;
import org.apache.tika.parser.microsoft.rtf.RTFParser;
import org.apache.tika.sax.BodyContentHandler;
import org.xml.sax.SAXException;
import sim.kantordesa.config.AppContext;
import sim.kantordesa.config.koneksi;
import sim.kantordesa.dashboard.Dashboard;
import com.itextpdf.layout.element.TabStop;
import com.itextpdf.layout.properties.TabAlignment;
import java.util.ArrayList;
import java.util.List;

/**
 *
 * @author manii
 */
public class mailform extends javax.swing.JFrame {

    public int mailTypeId;
    public String title;

    public mailform(String title, int mailTypeId) {
        this.mailTypeId = mailTypeId;
        this.title = title;
        initComponents();
        updateTitle(title);
    }

    public mailform() {
        initComponents();
    }

    public JPanel getContentPanel() {
        return (JPanel) this.getContentPane();
    }
    
    public void updateData() {
        String mailform_templateName = (String) AppContext.get("mailform_templateName");
        Integer mailform_mailTypeId = (Integer) AppContext.get("mailform_mailTypeId");
        this.title = mailform_templateName != null ? mailform_templateName : "MAIL FORM";
        this.mailTypeId = mailform_mailTypeId != null ? mailform_mailTypeId : 0;
        updateTitle(this.title);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated
    // Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        group_warganegara = new javax.swing.ButtonGroup();
        group_jeniskelamin = new javax.swing.ButtonGroup();
        body = new javax.swing.JPanel();
        header = new javax.swing.JPanel();
        form_title = new javax.swing.JLabel();
        btn_next = new javax.swing.JButton();
        btn_back = new javax.swing.JButton();
        nama = new javax.swing.JLabel();
        text_nama = new javax.swing.JTextField();
        tgl_lahir = new javax.swing.JLabel();
        text_tgl_lahir = new javax.swing.JTextField();
        umur = new javax.swing.JLabel();
        jUmur = new javax.swing.JSpinner();
        warganegara = new javax.swing.JLabel();
        wni = new javax.swing.JRadioButton();
        wna = new javax.swing.JRadioButton();
        gender = new javax.swing.JLabel();
        lakilaki = new javax.swing.JRadioButton();
        perempuan = new javax.swing.JRadioButton();
        ttinggal = new javax.swing.JLabel();
        text_ttinggal = new javax.swing.JTextField();
        goldar = new javax.swing.JLabel();
        box_goldar = new javax.swing.JComboBox<>();
        no_ktp = new javax.swing.JLabel();
        no_kk = new javax.swing.JLabel();
        text_noktp = new javax.swing.JTextField();
        text_nokk = new javax.swing.JTextField();
        jScrollPane1 = new javax.swing.JScrollPane();
        text_keperluan = new javax.swing.JTextArea();
        keperluan = new javax.swing.JLabel();
        sd = new javax.swing.JLabel();
        daritanggal = new com.toedter.calendar.JDateChooser();
        berlaku = new javax.swing.JLabel();
        sampaitanggal = new com.toedter.calendar.JDateChooser();
        box_agama = new javax.swing.JComboBox<>();
        agama = new javax.swing.JLabel();
        text_pekerjaan = new javax.swing.JTextField();
        pekerjaan = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        body.setPreferredSize(new java.awt.Dimension(1300, 640));

        header.setBackground(new java.awt.Color(19, 128, 97));
        header.setPreferredSize(new java.awt.Dimension(1200, 80));

        form_title.setFont(new java.awt.Font("Segoe UI", 1, 36)); // NOI18N
        form_title.setForeground(new java.awt.Color(255, 255, 255));
        form_title.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        form_title.setText("MAIL FORM");
        form_title.setPreferredSize(new java.awt.Dimension(200, 48));

        javax.swing.GroupLayout headerLayout = new javax.swing.GroupLayout(header);
        header.setLayout(headerLayout);
        headerLayout.setHorizontalGroup(
                headerLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(headerLayout.createSequentialGroup()
                                .addGap(60, 60, 60)
                                .addComponent(form_title, javax.swing.GroupLayout.PREFERRED_SIZE, 900,
                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addContainerGap(331, Short.MAX_VALUE)));
        headerLayout.setVerticalGroup(
                headerLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(headerLayout.createSequentialGroup()
                                .addGap(15, 15, 15)
                                .addComponent(form_title, javax.swing.GroupLayout.PREFERRED_SIZE,
                                        javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addContainerGap(17, Short.MAX_VALUE)));

        btn_next.setBackground(new java.awt.Color(19, 128, 97));
        btn_next.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        btn_next.setForeground(new java.awt.Color(255, 255, 255));
        btn_next.setText("Lanjutkan");
        btn_next.setPreferredSize(new java.awt.Dimension(120, 35));
        btn_next.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_nextActionPerformed(evt);
            }
        });

        btn_back.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        btn_back.setForeground(new java.awt.Color(19, 128, 97));
        btn_back.setText("Kembali");
        btn_back.setPreferredSize(new java.awt.Dimension(100, 35));
        btn_back.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_backActionPerformed(evt);
            }
        });

        nama.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        nama.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        nama.setText("Nama");

        text_nama.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        text_nama.setPreferredSize(new java.awt.Dimension(500, 35));

        tgl_lahir.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        tgl_lahir.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        tgl_lahir.setText("Tempat / Tanggal Lahir");

        text_tgl_lahir.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        text_tgl_lahir.setPreferredSize(new java.awt.Dimension(500, 35));

        umur.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        umur.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        umur.setText("Umur");

        jUmur.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jUmur.setPreferredSize(new java.awt.Dimension(64, 35));

        warganegara.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        warganegara.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        warganegara.setText("Warga Negara");

        group_warganegara.add(wni);
        wni.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        wni.setText("WNI");
        wni.setPreferredSize(new java.awt.Dimension(64, 35));

        group_warganegara.add(wna);
        wna.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        wna.setText("WNA");
        wna.setPreferredSize(new java.awt.Dimension(64, 35));

        gender.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        gender.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        gender.setText("Jenis Kelamin");

        group_jeniskelamin.add(lakilaki);
        lakilaki.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        lakilaki.setText("Laki - laki");
        lakilaki.setPreferredSize(new java.awt.Dimension(64, 35));

        group_jeniskelamin.add(perempuan);
        perempuan.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        perempuan.setText("Perempuan");
        perempuan.setPreferredSize(new java.awt.Dimension(120, 35));

        ttinggal.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        ttinggal.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        ttinggal.setText("Tempat Tinggal");

        text_ttinggal.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        text_ttinggal.setPreferredSize(new java.awt.Dimension(500, 35));

        goldar.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        goldar.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        goldar.setText("Golongan Darah");

        box_goldar.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        box_goldar.setMaximumRowCount(4);
        box_goldar.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "O", "AB", "A", "B" }));
        box_goldar.setToolTipText("");
        box_goldar.setMinimumSize(new java.awt.Dimension(64, 35));
        box_goldar.setPreferredSize(new java.awt.Dimension(64, 35));

        no_ktp.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        no_ktp.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        no_ktp.setText("Nomor KTP");

        no_kk.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        no_kk.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        no_kk.setText("Nomor KK");

        text_noktp.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        text_noktp.setPreferredSize(new java.awt.Dimension(500, 35));

        text_nokk.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        text_nokk.setPreferredSize(new java.awt.Dimension(500, 35));

        text_keperluan.setColumns(20);
        text_keperluan.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        text_keperluan.setRows(5);
        jScrollPane1.setViewportView(text_keperluan);

        keperluan.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        keperluan.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        keperluan.setText("Keperluan");

        sd.setFont(new java.awt.Font("Segoe UI", 1, 18)); // NOI18N
        sd.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        sd.setText("s/d");

        daritanggal.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        daritanggal.setMaxSelectableDate(new java.util.Date(253370739706000L));
        daritanggal.setPreferredSize(new java.awt.Dimension(140, 35));

        berlaku.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        berlaku.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        berlaku.setText("Berlaku");

        sampaitanggal.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        sampaitanggal.setMaxSelectableDate(new java.util.Date(253370739706000L));
        sampaitanggal.setPreferredSize(new java.awt.Dimension(140, 35));

        box_agama.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        box_agama.setMaximumRowCount(6);
        box_agama.setModel(new javax.swing.DefaultComboBoxModel<>(
                new String[] { "Islam", "Katolik", "Protestan", "Hindu", "Buddha", "Konghucu" }));
        box_agama.setToolTipText("");
        box_agama.setMinimumSize(new java.awt.Dimension(64, 35));
        box_agama.setPreferredSize(new java.awt.Dimension(200, 35));

        agama.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        agama.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        agama.setText("Agama");

        text_pekerjaan.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        text_pekerjaan.setPreferredSize(new java.awt.Dimension(500, 35));

        pekerjaan.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        pekerjaan.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        pekerjaan.setText("Pekerjaan");

        javax.swing.GroupLayout bodyLayout = new javax.swing.GroupLayout(body);
        body.setLayout(bodyLayout);
        bodyLayout.setHorizontalGroup(
                bodyLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(header, javax.swing.GroupLayout.DEFAULT_SIZE, 1291, Short.MAX_VALUE)
                        .addGroup(bodyLayout.createSequentialGroup()
                                .addGap(60, 60, 60)
                                .addGroup(bodyLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                        .addGroup(bodyLayout.createSequentialGroup()
                                                .addComponent(btn_next, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                .addGap(39, 39, 39)
                                                .addComponent(btn_back, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                .addGap(0, 972, Short.MAX_VALUE))
                                        .addGroup(bodyLayout.createSequentialGroup()
                                                .addGroup(bodyLayout
                                                        .createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                                        .addComponent(text_pekerjaan,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE,
                                                                javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                                        .addComponent(pekerjaan))
                                                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                                        .addGroup(bodyLayout.createSequentialGroup()
                                                .addGroup(bodyLayout
                                                        .createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                                        .addComponent(text_tgl_lahir,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE,
                                                                javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                                        .addComponent(text_nama, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                                javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                                        .addComponent(nama)
                                                        .addComponent(tgl_lahir)
                                                        .addComponent(text_ttinggal,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE,
                                                                javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                                        .addComponent(ttinggal)
                                                        .addComponent(warganegara)
                                                        .addComponent(jUmur, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                                javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                                        .addComponent(umur)
                                                        .addComponent(gender)
                                                        .addGroup(bodyLayout.createSequentialGroup()
                                                                .addComponent(lakilaki,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE, 98,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                                .addPreferredGap(
                                                                        javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                                .addComponent(perempuan,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE,
                                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE))
                                                        .addGroup(bodyLayout.createSequentialGroup()
                                                                .addComponent(wni,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE, 98,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                                .addPreferredGap(
                                                                        javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                                .addComponent(wna,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE, 98,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE))
                                                        .addGroup(bodyLayout
                                                                .createParallelGroup(
                                                                        javax.swing.GroupLayout.Alignment.LEADING,
                                                                        false)
                                                                .addComponent(box_agama, 0,
                                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                        Short.MAX_VALUE)
                                                                .addComponent(agama)))
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED,
                                                        javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                                .addGroup(bodyLayout
                                                        .createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                                        .addGroup(bodyLayout
                                                                .createParallelGroup(
                                                                        javax.swing.GroupLayout.Alignment.LEADING,
                                                                        false)
                                                                .addComponent(text_nokk,
                                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                        Short.MAX_VALUE)
                                                                .addComponent(text_noktp,
                                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                        Short.MAX_VALUE)
                                                                .addComponent(no_ktp)
                                                                .addComponent(no_kk)
                                                                .addComponent(keperluan))
                                                        .addGroup(bodyLayout.createSequentialGroup()
                                                                .addComponent(daritanggal,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE,
                                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                                .addGap(18, 18, 18)
                                                                .addComponent(sd)
                                                                .addGap(18, 18, 18)
                                                                .addComponent(sampaitanggal,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE,
                                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE))
                                                        .addComponent(berlaku)
                                                        .addComponent(jScrollPane1,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE, 500,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                                        .addGroup(bodyLayout
                                                                .createParallelGroup(
                                                                        javax.swing.GroupLayout.Alignment.LEADING,
                                                                        false)
                                                                .addComponent(box_goldar, 0,
                                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                        Short.MAX_VALUE)
                                                                .addComponent(goldar)))
                                                .addGap(60, 60, 60)))));
        bodyLayout.setVerticalGroup(
                bodyLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(bodyLayout.createSequentialGroup()
                                .addGroup(bodyLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                        .addGroup(bodyLayout.createSequentialGroup()
                                                .addComponent(header, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                .addGap(41, 41, 41)
                                                .addComponent(nama)
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                .addComponent(text_nama, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                                .addComponent(tgl_lahir)
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                .addComponent(text_tgl_lahir, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE))
                                        .addGroup(bodyLayout.createSequentialGroup()
                                                .addComponent(no_ktp)
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                .addComponent(text_noktp, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                                .addComponent(no_kk)
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                .addComponent(text_nokk, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE)))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addGroup(bodyLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                        .addComponent(umur)
                                        .addComponent(keperluan))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addGroup(bodyLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                        .addGroup(bodyLayout.createSequentialGroup()
                                                .addComponent(jUmur, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                                .addComponent(warganegara)
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                .addGroup(bodyLayout
                                                        .createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                                        .addComponent(wni, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                                javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                                        .addComponent(wna, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                                javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE))
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                                .addComponent(gender)
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                .addGroup(bodyLayout
                                                        .createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                                        .addComponent(lakilaki, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                                javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                                        .addComponent(perempuan, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                                javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE)))
                                        .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 190,
                                                javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addGroup(bodyLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                        .addGroup(bodyLayout.createSequentialGroup()
                                                .addComponent(goldar)
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                .addComponent(box_goldar, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE))
                                        .addGroup(bodyLayout.createSequentialGroup()
                                                .addComponent(agama)
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                .addComponent(box_agama, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE)))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addGroup(bodyLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                        .addGroup(bodyLayout.createSequentialGroup()
                                                .addComponent(berlaku)
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                .addComponent(daritanggal, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE))
                                        .addComponent(sd)
                                        .addComponent(sampaitanggal, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                javax.swing.GroupLayout.DEFAULT_SIZE,
                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addGroup(bodyLayout.createSequentialGroup()
                                                .addComponent(ttinggal)
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                .addComponent(text_ttinggal, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE)))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(pekerjaan)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(text_pekerjaan, javax.swing.GroupLayout.PREFERRED_SIZE,
                                        javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 19,
                                        Short.MAX_VALUE)
                                .addGroup(bodyLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                        .addComponent(btn_next, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                javax.swing.GroupLayout.DEFAULT_SIZE,
                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(btn_back, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                javax.swing.GroupLayout.DEFAULT_SIZE,
                                                javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addGap(30, 30, 30)));

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
                layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(body, javax.swing.GroupLayout.DEFAULT_SIZE, 1291, Short.MAX_VALUE));
        layout.setVerticalGroup(
                layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(layout.createSequentialGroup()
                                .addComponent(body, javax.swing.GroupLayout.DEFAULT_SIZE, 786, Short.MAX_VALUE)
                                .addGap(0, 0, Short.MAX_VALUE)));

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void btn_nextActionPerformed(java.awt.event.ActionEvent evt) {
        Connection conn = koneksi.getConnection();
        String title = form_title.getText();
        String ktp = text_noktp.getText().trim();
        String kk = text_nokk.getText().trim();
        String nama = text_nama.getText().trim();
        String tempatTanggalLahir = text_tgl_lahir.getText().trim();
        String alamat = text_ttinggal.getText().trim();
        String pekerjaan = text_pekerjaan.getText().trim();

        if (!ktp.matches("\\d{1,16}")) {
            javax.swing.JOptionPane.showMessageDialog(this, "No KTP harus berupa angka dan maksimal 16 karakter!",
                    "Peringatan", javax.swing.JOptionPane.WARNING_MESSAGE);
            return;
        }

        if (!kk.matches("\\d{1,16}")) {
            javax.swing.JOptionPane.showMessageDialog(this, "No KK harus berupa angka dan maksimal 16 karakter!",
                    "Peringatan", javax.swing.JOptionPane.WARNING_MESSAGE);
            return;
        }

        if (nama.length() > 100 || !nama.matches("^[a-zA-Z\\s]+$")) {
            javax.swing.JOptionPane.showMessageDialog(this,
                    "Nama tidak boleh lebih dari 100 karakter dan harus berupa huruf!", "Peringatan",
                    javax.swing.JOptionPane.WARNING_MESSAGE);
            return;
        }

        if (tempatTanggalLahir.length() > 100) {
            javax.swing.JOptionPane.showMessageDialog(this,
                    "Tempat dan tanggal lahir tidak boleh lebih dari 100 karakter!", "Peringatan",
                    javax.swing.JOptionPane.WARNING_MESSAGE);
            return;
        }

        if (alamat.length() > 100) {
            javax.swing.JOptionPane.showMessageDialog(this, "Alamat tidak boleh lebih dari 100 karakter!", "Peringatan",
                    javax.swing.JOptionPane.WARNING_MESSAGE);
            return;
        }

        if (pekerjaan.length() > 50) {
            javax.swing.JOptionPane.showMessageDialog(this, "Pekerjaan tidak boleh lebih dari 50 karakter!",
                    "Peringatan", javax.swing.JOptionPane.WARNING_MESSAGE);
            return;
        }

        saveData();
        generatePDF(this.mailTypeId, conn, title);
    }

    private void btn_backActionPerformed(java.awt.event.ActionEvent evt) {
        Dashboard.switchPanel("Template Selector");
    }

    public final void updateTitle(String title) {
        this.setTitle(title);
        form_title.setText(title);
    }

    private void saveData() {
        Connection conn = koneksi.getConnection();
        String queryCivilRegistry = "INSERT INTO civil_registry (nama, no_ktp, no_kk, tempat_tanggal_lahir, warga_negara, agama, jenis_kelamin, pekerjaan, alamat, gol_darah) "
                + "VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)";
        String queryUpdateMailContent = "UPDATE mail_content SET no_ktp = ?, mulai_berlaku = ?, tgl_akhir = ? "
                + "WHERE mail_id = (SELECT mail_id FROM mail_content ORDER BY mail_id DESC LIMIT 1)";
        try (PreparedStatement stmt1 = conn.prepareStatement(queryCivilRegistry);
                PreparedStatement stmt2 = conn.prepareStatement(queryUpdateMailContent)) {
            stmt1.setString(1, text_nama.getText());
            stmt1.setString(2, text_noktp.getText());
            stmt1.setString(3, text_nokk.getText());
            stmt1.setString(4, text_tgl_lahir.getText());
            stmt1.setString(5, wni.isSelected() ? "WNI" : "WNA");
            stmt1.setString(6, box_agama.getSelectedItem().toString());
            stmt1.setString(7, lakilaki.isSelected() ? "Laki-laki" : "Perempuan");
            stmt1.setString(8, text_pekerjaan.getText());
            stmt1.setString(9, text_ttinggal.getText());
            stmt1.setString(10, box_goldar.getSelectedItem().toString());
            int rowsInserted = stmt1.executeUpdate();
            Logger.getLogger(mailform.class.getName()).log(Level.INFO, "Baris dimasukkan ke civil_registry: {0}",
                    rowsInserted);

            SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd");
            String mulaiBerlaku = dateFormat.format(daritanggal.getDate());
            String tglAkhir = dateFormat.format(sampaitanggal.getDate());

            stmt2.setString(1, text_noktp.getText());
            stmt2.setString(2, mulaiBerlaku);
            stmt2.setString(3, tglAkhir);
            int rowsUpdated = stmt2.executeUpdate();
            Logger.getLogger(mailform.class.getName()).log(Level.INFO, "Baris diperbarui di mail_content: {0}",
                    rowsUpdated);

            JOptionPane.showMessageDialog(this, "Data berhasil disimpan dan diperbarui!", "Sukses",
                    JOptionPane.INFORMATION_MESSAGE);
        } catch (SQLException ex) {
            Logger.getLogger(mailform.class.getName()).log(Level.SEVERE, "Kesalahan SQL: " + ex.getMessage(), ex);
        } catch (Exception ex) {
            Logger.getLogger(mailform.class.getName()).log(Level.SEVERE, "Kesalahan: " + ex.getMessage(), ex);
        }
    }

    private Map<String, String> getVillageData() {
        Connection conn = koneksi.getConnection();
        Map<String, String> villageData = new HashMap<>();
        String query = "SELECT district, subdistrict, village_name, village_loc, village_id FROM village_data LIMIT 1";
        try (PreparedStatement stmt = conn.prepareStatement(query); ResultSet rs = stmt.executeQuery()) {
            if (rs.next()) {
                villageData.put("nama_kab", rs.getString("district"));
                villageData.put("nama_kec", rs.getString("subdistrict"));
                villageData.put("nama_des", rs.getString("village_name"));
                villageData.put("alamat_des", rs.getString("village_loc"));
                villageData.put("kode_des", rs.getString("village_id"));
            } else {
                Logger.getLogger(mailform.class.getName()).log(Level.WARNING, "No data found in village_data table.");
            }
        } catch (SQLException ex) {
            Logger.getLogger(mailform.class.getName()).log(Level.SEVERE, "SQL Exception: " + ex.getMessage(), ex);
        }
        Logger.getLogger(mailform.class.getName()).log(Level.INFO, "Village Data: {0}", villageData);
        return villageData;
    }

    private String replacePlaceholders(String content, Map<String, String> villageData) {
        SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
        String dariTanggal = sdf.format(daritanggal.getDate());
        String sampaiTanggal = sdf.format(sampaitanggal.getDate());

        return content.replace("[nama]", text_nama.getText() != null ? text_nama.getText() : "")
                .replace("[ttl]", text_tgl_lahir.getText() != null ? text_tgl_lahir.getText() : "")
                .replace("[usia]", jUmur.getValue() != null ? jUmur.getValue().toString() : "")
                .replace("[warga_negara]", wni.isSelected() ? "WNI" : "WNA")
                .replace("[agama]", box_agama.getSelectedItem() != null ? box_agama.getSelectedItem().toString() : "")
                .replace("[sex]", lakilaki.isSelected() ? "Laki-laki" : "Perempuan")
                .replace("[pekerjaan]", text_pekerjaan.getText() != null ? text_pekerjaan.getText() : "")
                .replace("[alamat]", text_ttinggal.getText() != null ? text_ttinggal.getText() : "")
                .replace("[no_ktp]", text_noktp.getText() != null ? text_noktp.getText() : "")
                .replace("[no_kk]", text_nokk.getText() != null ? text_nokk.getText() : "")
                .replace("[keperluan]", text_keperluan.getText() != null ? text_keperluan.getText() : "")
                .replace("[mulai_berlaku]", dariTanggal)
                .replace("[tgl_akhir]", sampaiTanggal)
                .replace("[gol_darah]",
                        box_goldar.getSelectedItem() != null ? box_goldar.getSelectedItem().toString() : "")
                .replace("[nama_kab]", villageData.getOrDefault("nama_kab", ""))
                .replace("[nama_kec]", villageData.getOrDefault("nama_kec", ""))
                .replace("[nama_des]", villageData.getOrDefault("nama_des", ""))
                .replace("[alamat_des]", villageData.getOrDefault("alamat_des", ""))
                .replace("[kode_des]", villageData.getOrDefault("kode_des", ""));
    }

    private String loadRTFTemplate() {
        try {
            Connection conn = koneksi.getConnection();
            PreparedStatement stmt = conn.prepareStatement("SELECT mail_type FROM mail_type WHERE mail_type_id = ?");
            stmt.setInt(1, this.mailTypeId);
            ResultSet rs = stmt.executeQuery();
            if (rs.next()) {
                return rs.getString("mail_type");
            }
        } catch (SQLException ex) {
            Logger.getLogger(mailform.class.getName()).log(Level.SEVERE, null, ex);
        }
        return null;
    }

    private String generateNomorSurat(int mailTypeId) {
        int tahun = LocalDate.now().getYear();
        return mailTypeId + "/" + tahun;
    }

    private void generatePDF(int mailTypeId, Connection conn, String title) {

        try {
            String rtfPath = loadRTFTemplate();
            if (rtfPath == null || rtfPath.isEmpty()) {
                JOptionPane.showMessageDialog(null, "RTF Template not found.", "Error", JOptionPane.ERROR_MESSAGE);
                return;
            }
            BodyContentHandler handler = new BodyContentHandler();
            new RTFParser().parse(new FileInputStream(rtfPath), handler, new org.apache.tika.metadata.Metadata(),
                    new ParseContext());

            // Ambil data desa
            Map<String, String> villageData = getVillageData();

            // Ambil data pemegang surat dari placeholders
            String pemegangSurat = replacePlaceholders("[nama]", villageData);

            // Ambil mail_id dan type_name
            String query = "SELECT mail_id, type_name FROM mail_content mc "
                    + "INNER JOIN mail_type mt ON mc.mail_type_id = mt.mail_type_id "
                    + "WHERE mc.mail_type_id = ? ORDER BY mail_id DESC LIMIT 1";
            String fileName = "output.pdf";
            try (PreparedStatement stmt = conn.prepareStatement(query)) {
                stmt.setInt(1, mailTypeId);
                ResultSet rs = stmt.executeQuery();
                if (rs.next()) {
                    int mailId = rs.getInt("mail_id");
                    String typeName = rs.getString("type_name");
                    fileName = mailId + "_" + typeName + ".pdf";
                }
            } catch (SQLException ex) {
                Logger.getLogger(mailform.class.getName()).log(Level.SEVERE, null, ex);
            }

            // Simpan ke PDF
            JFileChooser fileChooser = new JFileChooser();
            fileChooser.setDialogTitle("Simpan File PDF");
            fileChooser.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);

            if (fileChooser.showSaveDialog(null) == JFileChooser.APPROVE_OPTION) {
                String outputDir = fileChooser.getSelectedFile().getAbsolutePath();
                String pdfPath = outputDir + "/" + fileName;

                try (PdfWriter writer = new PdfWriter(pdfPath);
                        PdfDocument pdf = new PdfDocument(writer);
                        Document document = new Document(pdf)) {

                    // Header
                    Paragraph header = new Paragraph("PEMERINTAH " + villageData.get("nama_kab"))
                            .setFontSize(16).setTextAlignment(TextAlignment.CENTER);
                    header.add(new Text("\n" + villageData.get("nama_kec") + "\n" + villageData.get("nama_des") + "\n"))
                            .setFontSize(16).setTextAlignment(TextAlignment.CENTER);
                    header.add(villageData.get("alamat_des"));
                    document.add(header);

                    // Kode Desa dan Kode Surat
                    Table kodeTable = new Table(UnitValue.createPercentArray(new float[] { 1, 1 }));
                    kodeTable.setWidth(UnitValue.createPercentValue(100));
                    kodeTable.setBorder(Border.NO_BORDER);
                    kodeTable.addCell(
                            new Paragraph(villageData.get("kode_des") != null ? villageData.get("kode_des") : "")
                                    .setTextAlignment(TextAlignment.LEFT).setFontSize(12))
                            .setBorder(Border.NO_BORDER);
                    kodeTable.addCell(new Paragraph("" + mailTypeId)
                            .setTextAlignment(TextAlignment.RIGHT).setFontSize(12))
                            .setBorder(Border.NO_BORDER);
                    document.add(kodeTable);

                    // Title
                    Paragraph suratTitle = new Paragraph(title)
                            .setFontSize(16).setTextAlignment(TextAlignment.CENTER).setMarginBottom(10);
                    document.add(suratTitle);

                    // Nomor Surat
                    String noSurat = generateNomorSurat(mailTypeId);
                    Paragraph nomorSurat = new Paragraph("Nomor: " + noSurat)
                            .setTextAlignment(TextAlignment.CENTER).setFontSize(12).setMarginBottom(20);
                    document.add(nomorSurat);

                    SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
                    String dariTanggal = sdf.format(daritanggal.getDate());
                    String sampaiTanggal = sdf.format(sampaitanggal.getDate());
                    
                    List<TabStop> tabStops = new ArrayList<>();
                    tabStops.add(new TabStop(200, TabAlignment.LEFT));
                    tabStops.add(new TabStop(400, TabAlignment.LEFT));

                    // Main Content
                    Paragraph mainContent = new Paragraph().addTabStops(tabStops)
                            .add(new Text("Nama\t\t\t\t\t\t\t: "
                                    + (text_nama.getText() != null ? text_nama.getText() : "")).setFontSize(12))
                            .add(new Text("\nTempat/tanggal lahir\t : "
                                    + (text_tgl_lahir.getText() != null ? text_tgl_lahir.getText() : ""))
                                    .setFontSize(12))
                            .add(new Text("\nUsia\t\t\t\t\t\t\t: "
                                    + (jUmur.getValue() != null ? jUmur.getValue().toString() : "")).setFontSize(12))
                            .add(new Text("\nWarga negara\t\t\t\t\t: " + (wni.isSelected() ? "WNI" : "WNA"))
                                    .setFontSize(12))
                            .add(new Text("\nAgama\t\t\t\t\t\t: "
                                    + (box_agama.getSelectedItem() != null ? box_agama.getSelectedItem().toString()
                                            : ""))
                                    .setFontSize(12))
                            .add(new Text(
                                    "\nJenis Kelamin          : " + (lakilaki.isSelected() ? "Laki-laki" : "Perempuan"))
                                    .setFontSize(12))
                            .add(new Text("\nPekerjaan              : "
                                    + (text_pekerjaan.getText() != null ? text_pekerjaan.getText() : ""))
                                    .setFontSize(12))
                            .add(new Text("\nTempat Tinggal         : "
                                    + (text_ttinggal.getText() != null ? text_ttinggal.getText() : "")).setFontSize(12))
                            .add(new Text("\n\nSurat bukti diri").setFontSize(12))
                            .add(new Text("\nKTP                    : "
                                    + (text_noktp.getText() != null ? text_noktp.getText() : "")).setFontSize(12))
                            .add(new Text("\nKK                     : "
                                    + (text_nokk.getText() != null ? text_nokk.getText() : "")).setFontSize(12))
                            .add(new Text("\nKeperluan              : Mohon keterangan yang akan dipergunakan untuk "
                                    + (text_keperluan.getText() != null ? text_keperluan.getText() : ""))
                                    .setFontSize(12))
                            .add(new Text("\nBerlaku                : " + dariTanggal + " s/d " + sampaiTanggal)
                                    .setFontSize(12))
                            .add(new Text("\nGolongan Darah         : "
                                    + (box_goldar.getSelectedItem() != null ? box_goldar.getSelectedItem().toString()
                                            : ""))
                                    .setFontSize(12))
                            .add(new Text(
                                    "\n\nDemikian Surat ini dibuat, untuk dipergunakan sebagaimana mestinya.\n\n\n\n")
                                    .setFontSize(12));

                    document.add(mainContent);

                    // Signature Table
                    Table signatureTable = new Table(UnitValue.createPercentArray(new float[] { 1, 1, 1 }));
                    signatureTable.setWidth(UnitValue.createPercentValue(100));
                    signatureTable.setBorder(Border.NO_BORDER);

                    signatureTable.addCell(new Paragraph("Pemegang Surat\n\n\n\n\n" + pemegangSurat)
                            .setTextAlignment(TextAlignment.CENTER).setFontSize(12))
                            .setBorder(Border.NO_BORDER);
                    signatureTable.addCell(
                            new Paragraph("Mengetahui,\nCamat " + villageData.get("nama_kec") + "\n\n\n\nI Gede Camat")
                                    .setTextAlignment(TextAlignment.CENTER).setFontSize(12))
                            .setBorder(Border.NO_BORDER);
                    signatureTable
                            .addCell(new Paragraph(villageData.get("nama_des") + ", "
                                    + LocalDate.now().format(DateTimeFormatter.ofPattern("dd MMMM yyyy")) +
                                    "\nJabatan " + villageData.get("nama_des") + "\n\n\n\nI Kadek Bendesa")
                                    .setTextAlignment(TextAlignment.CENTER).setFontSize(12))
                            .setBorder(Border.NO_BORDER);

                    document.add(signatureTable);
                } catch (IOException ex) {
                    Logger.getLogger(mailform.class.getName()).log(Level.SEVERE, null, ex);
                }

                // Update mail_content dengan mail_number dan file_path
                String mailNumber = mailTypeId + "/" + villageData.get("kode_des") + "/"
                        + LocalDate.now().format(DateTimeFormatter.ofPattern("yyyy"));
                updateMailContent(conn, mailNumber);

                JOptionPane.showMessageDialog(null, "File PDF berhasil disimpan di: " + pdfPath, "Sukses",
                        JOptionPane.INFORMATION_MESSAGE);
            }
        } catch (SQLException | IOException | SAXException | TikaException ex) {
            Logger.getLogger(mailform.class.getName()).log(Level.SEVERE, null, ex);
        }
    }

    private void updateMailContent(Connection conn, String mailNumber) throws SQLException {
        String query = "UPDATE mail_content SET mail_number = ?, status = 'Diproses', mail_date = ?, "
                + "created_at = NOW(), updated_at = NOW() WHERE mail_type_id = ?";
        try (PreparedStatement stmt = conn.prepareStatement(query)) {
            stmt.setString(1, mailNumber);
            stmt.setString(2, LocalDate.now().format(DateTimeFormatter.ofPattern("yyyy-MM-dd")));
            stmt.setInt(3, this.mailTypeId);
            stmt.executeUpdate();
        }
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel agama;
    private javax.swing.JLabel berlaku;
    private javax.swing.JPanel body;
    private javax.swing.JComboBox<String> box_agama;
    private javax.swing.JComboBox<String> box_goldar;
    private javax.swing.JButton btn_back;
    private javax.swing.JButton btn_next;
    private com.toedter.calendar.JDateChooser daritanggal;
    private javax.swing.JLabel form_title;
    private javax.swing.JLabel gender;
    private javax.swing.JLabel goldar;
    private javax.swing.ButtonGroup group_jeniskelamin;
    private javax.swing.ButtonGroup group_warganegara;
    private javax.swing.JPanel header;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JSpinner jUmur;
    private javax.swing.JLabel keperluan;
    private javax.swing.JRadioButton lakilaki;
    private javax.swing.JLabel nama;
    private javax.swing.JLabel no_kk;
    private javax.swing.JLabel no_ktp;
    private javax.swing.JLabel pekerjaan;
    private javax.swing.JRadioButton perempuan;
    private com.toedter.calendar.JDateChooser sampaitanggal;
    private javax.swing.JLabel sd;
    private javax.swing.JTextArea text_keperluan;
    private javax.swing.JTextField text_nama;
    private javax.swing.JTextField text_nokk;
    private javax.swing.JTextField text_noktp;
    private javax.swing.JTextField text_pekerjaan;
    private javax.swing.JTextField text_tgl_lahir;
    private javax.swing.JTextField text_ttinggal;
    private javax.swing.JLabel tgl_lahir;
    private javax.swing.JLabel ttinggal;
    private javax.swing.JLabel umur;
    private javax.swing.JLabel warganegara;
    private javax.swing.JRadioButton wna;
    private javax.swing.JRadioButton wni;
    // End of variables declaration//GEN-END:variables
}
